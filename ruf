<% layout("layouts/boilerplate") %>
<body>
  <div class="container mt-4">
    <h3 class="mb-4">All Listings</h3>

    <div class="row">
      <% for (let listing of allListings) { %>
      <div class="col-md-4 mb-3">
        <div class="card" style="width: 18rem">
          <!-- image -->
          <img
            src="<%= listing.image %>"
            class="card-img-top"
            alt="<%= listing.title %>"
          />

          <!-- body -->
          <div class="card-body">
            <h5 class="card-title"><%= listing.title %></h5>
            <p class="card-text">
              Price: â‚¹<%= listing.price %> <br />
              Location: <%= listing.location %>, <%= listing.country %>
            </p>
            <a href="/listings/<%= listing._id %>" class="btn btn-primary"
              >View Details</a
            >
          </div>
        </div>
      </div>
      <% } %>
    </div>
  </div>
</body>

<!-- ...................................... -->
body { display: flex; flex-direction: column; min-height: 100vh; font-family:
"Plus Jakarta Sans", sans-serif; } .container { flex: 1; } /* navbar */ .navbar
{ height: 5rem; background-color: white; } .fa-compass { color: red; } .nav-link
{ color: #222224 important!; } /* footer */ .f-info-links a { text-decoration:
none; color: #222222; } .f-info-links a:hover { text-decoration: underline; }
.f-info-links { width: 100%; } .f-info-socials { width: 100%; font-size: 1.3rem;
margin-top: 1rem; } .f-info-socials i { margin-right: 5px; } .f-info {
text-align: center; height: 10rem; background-color: #ebebeb; display: flex;
flex-wrap: wrap; justify-content: space-around; } /* card */ .card { border:
none; /* remove default Bootstrap border */ border-radius: 1rem; /* round the
card itself */ overflow: hidden; /* makes image stick to edges */ }
.card-img-top { border-radius: 0; /* let card handle rounding */ object-fit:
cover; border-radius: 1rem !important; width: 100% !important; object-fit: cover
!important; } .card-body { padding: 0 !important; } .card-text p { font-weight:
400; } .listing-link { text-decoration: none; } /* card effects */
.card-img-overlay { opacity: 0; } .card-img-overlay:hover { opacity: 0.2;
background-color: white; } /* new template */ .add-btn { background-color:
#fe424d !important; border: none !important; } /* edit page */ .edit-btn {
background-color: #fe424d !important; border: none !important; /* width: 5rem
!important; */ } /* show page */ .show-img { height: 30vh; } .btns { display:
flex; } .show-card { padding-left: 0; padding-right: 0; }

<!-- ...................................... -->

// Example starter JavaScript for disabling form submissions if there are
invalid fields (() => { "use strict"; // Fetch all the forms we want to apply
custom Bootstrap validation styles to const forms =
document.querySelectorAll(".needs-validation"); // Loop over them and prevent
submission Array.from(forms).forEach((form) => { form.addEventListener(
"submit", (event) => { if (!form.checkValidity()) { event.preventDefault();
event.stopPropagation(); } form.classList.add("was-validated"); }, false ); });
})();

//////////////////////////////////

wrapAsync
-better way to write try catch block function



  <!-- <% if (currUser && listing.owner && listing.owner._id.equals(currUser._id)) {
  %> -->

  <!-- <%}%> -->



  <!-- route listing.js -->

  // const express = require("express");
// const router = express.Router(); //creates new router object
// // require file from app.js
// const wrapAsync = require("../utils/wrapAsync.js");
// const ExpressError = require("../utils/ExpressError.js");
// const { listingSchema, reviewSchema } = require("../schema.js"); //for server side validation
// const Listing = require("../models/listing.js"); //
// const { isLoggedIn, isOwner, validateListing } = require("../middleware.js");
// const listingController = require("../controller/listings");

// // error ko validate krna  jo ki  joi se ho agr neche use kr rhe  hm post route me

// // index route
// router.get("/", wrapAsync(listingController.index));

// // new route
// router.get("/new", isLoggedIn, listingController.renderNewForm);

// // show route
// router.get("/:id", wrapAsync(listingController.showListing));

// // Create Route
// // error handling using wrapAsyncðŸ‘Œ
// router.post(
//   "/",
//   isLoggedIn,
//   validateListing,
//   wrapAsync(listingController.createListing)
// );

// // Edit Route
// router.get(
//   "/:id/edit",
//   isLoggedIn,
//   isOwner,
//   wrapAsync(listingController.renderEditForm)
// );

// // update Route
// router.put(
//   "/:id",
//   isLoggedIn,
//   isOwner,
//   validateListing,
//   wrapAsync(listingController.updateListing)
// );

// // delete route
// router.delete(
//   "/:id",
//   isLoggedIn,
//   isOwner,
//   wrapAsync(listingController.destroyListing )
// );

// module.exports = router;


// route user

//without mvc framewok

// const express = require("express");
// const router = express.Router();
// const User = require("../models/user.js");
// const wrapAsync = require("../utils/wrapAsync");
// const passport = require("passport");
// const { saveRedirectUrl } = require("../middleware.js");
// // const userController = require("../controller/users.js");

// router.get("/signup", (req, res) => {
//   res.render("users/signup");
// });

// router.post(
//   "/signup",
//   wrapAsync(async (req, res) => {
//     try {
//       let { username, email, password } = req.body;
//       const newUser = new User({ email, username });
//       const registeredUser = await User.register(newUser, password);
//       console.log(registeredUser);
//       // Auto-login after signup
//       req.login(registeredUser, (err) => {
//         if (err) {
//           return next(err);
//         }
//         req.flash("success", "welcome to the wanderstayðŸ˜Ž");
//         res.redirect("/listings");
//       });
//     } catch (e) {
//       req.flash("error", e.message);
//       res.redirect("/signup");
//     }
//   })
// );
// //logiin route
// router.get("/login", (req, res) => {
//   res.render("users/login");
// });
// //

// router.post(
//   "/login",
//   saveRedirectUrl,
//   passport.authenticate("local", {
//     failureRedirect: "/login",
//     failureFlash: true,
//   }),
//   async (req, res) => {
//     req.flash("success", "Welcome back to WanderStay ðŸ˜Ž");

//     const redirectUrl = res.locals.redirectUrl || "/listings";

//     delete req.session.redirectUrl; // clean session

//     res.redirect(redirectUrl);
//   }
// );
// //
// router.get("/logout", (req, res, next) => {
//   req.logout((err) => {
//     if (err) {
//       return next(err);
//     }
//     req.flash("success", "You are log out WanderStayðŸ˜Ž");
//     res.redirect("/listings");
//   });
// });

// module.exports = router;



// controller listing.js
// const Listing = require("../models/listing");

// module.exports.index = async (req, res) => {
//   const allListings = await Listing.find({});
//   res.render("listings/index.ejs", { allListings });
// };

// module.exports.renderNewForm = (req, res) => {
//   res.render("listings/new.ejs");
// };

// module.exports.showListing = async (req, res) => {
//   let { id } = req.params;
//   const listing = await Listing.findById(id)
//     .populate({
//       path: "reviews",
//       populate: {
//         path: "author",
//       },
//     })
//     .populate("owner");
//   if (!listing) {
//     req.flash("error", "Listing you requested for does not exist!");
//     res.redirect("/listings");
//   } else {
//     console.log(listing);
//     res.render("listings/show.ejs", { listing });
//   }
// };

// module.exports.createListing = async (req, res, next) => {
//   // if (!req.body.listing) {
//   //   // req  me koi body nhi huye to ye send ho jayega
//   //   throw new ExpressError(400, "send valid data for listing");
//   // }

//   // validate using joi
  
//   // if we use this as a middleware then we create middleware for this above {under the root route}

//   const newListing = new Listing(req.body.listing); //instance of listing(req ki body se listing object ko niklana)
//   console.log(req.user);
//   newListing.isOwner = req.user._id;
//   await newListing.save(); //insert this document into MongoDB.â€
//   req.flash("success", "New Listing Created");
//   res.redirect("/listings");
// };

// module.exports.renderEditForm = async (req, res) => {
//   let { id } = req.params;
//   const listing = await Listing.findById(id); //particular listing ko find kr liya
//   if (!listing) {
//     req.flash("error", "Listing you requested for does not exist!");
//     return res.redirect("/listings");
//   }
//   res.render("listings/edit.ejs", { listing });
// };

// module.exports.updateListing = async (req, res) => {
//   if (!req.body.listing) {
//     throw new ExpressError(400, "send valid data for listing");
//   }

//   let { id } = req.params;
//   await Listing.findByIdAndUpdate(id, { ...req.body.listing }); //req.body.listing javascipt ki object he jiske andar sare ke sare parameter he
//   req.flash("success", "Listing Updated");
//   res.redirect(`/listings/${id}`); //redirect to show route
// };

// module.exports.destroyListing = async (req, res) => {
//   let { id } = req.params;
//   let deleteListing = await Listing.findByIdAndDelete(id); //this is also call the post mongoose middle ware
//   console.log("delete listing" + deleteListing);
//   req.flash("success", "Listing Deleted");
//   res.redirect("/listings");
// };

// image url likea link
// <!-- <div class="mb-3">
//         <label for="image" class="form-label">Image link</label>
//         <input
//           name="listing[image]"
//           value="<%= listing.image %>"
//           type="text"
//           class="form-control"
//           id="image"
//           required
//         />
//         <div class="valid-feedback">Nice image!</div>
//         <div class="invalid-feedback">Image should be there</div>
//       </div> -->